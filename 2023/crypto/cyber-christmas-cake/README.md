# Cyber Christmas Cake (crypto) (author: stn)

## Tools

**john the ripper** - password cracker tool, our tool of choice

**hashcat** - another password 'recovery' utility. This one seems a bit more advanced than john, with more options, GPU support etc. I also find it harder to use

**office2john** - extracts hashes from encrypted office files


## Description

```
Do you want to try our secret Cyber Christmas Cake recipe? Just open the file!
```

## Task analysis & solution

In the description, we are provided with a .doc file called Cake.doc, which is protected by a password. Whenever it comes to cracking passwords, there's one tool that immediately pops in our heads - **John the Ripper**

The first thing we need to do though, is to extract the hash of our protected Cake file. That we're going to accomplish by using another tool, **office2john**. It should already be present on the jumbo version of John the Ripper and on Kali Linux. office2john is a python script that works against those password protected files generated by Microsoft Office, hence the name. 

Now, to extract the hash, we need to run the following command:

```shell
└─$ office2john Cake.doc > passwordhash.txt
```

The tool will run its magic on Cake.doc and then save the output to passwordhash.txt. Let's see what's in there:

```
Cake.doc:$oldoffice$4*fe5f10119d14f79517d6e51fa0d142a6*2c212625444fe81701706b6b69eab450*818fb5ece5570f7794cc624cb92588d78490a613:::::Cake.doc
```

Now we need to run John with a wordlist file and this password hash. What John will do, is that the tool will start hashing all the predefined strings in that wordlist and compare them to the hash we extracted previously. This is the so-called dictionary attack. It will run until it finds the password, or until it runs out of words :)) The wordlist of choice here would come from rockyou.txt. The command would be as follows:

```shell
└─$ john --wordlist=rockyou.txt passwordhash.txt
Warning: detected hash type "oldoffice", but the string is also recognized as "oldoffice-opencl"
Use the "--format=oldoffice-opencl" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (oldoffice, MS Office <= 2003 [MD5/SHA1 RC4 32/64])
Cost 1 (hash type) is 4 for all loaded hashes
Will run 16 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
santa123         (Cake.doc)
1g 0:00:00:00 DONE (2023-12-17 16:41) 34.48g/s 2542Kp/s 2542Kc/s 2542KC/s rozalia..compu
Use the "--show --format=oldoffice" options to display all of the cracked passwords reliably
Session completed
```

We actually got the password on one of the last few lines - **santa123**. Now let's open the word file with it. It contains the recipe for a Blue Cyber Christmas Cake and a flag right at the bottom.

```shell

#Blue Cyber Christmas Cake Recipe

#NOTE: It is not safe to make and eat this AI generated cake!
#Ingredients:

........................................

MilestoneCTF{not-every-secret-is-worth-sharing}
```

And here we go, the flag is **MilestoneCTF{not-every-secret-is-worth-sharing}**